##################################################################################################################################
##################################################################################################################################
##################################################################################################################################
##################################################################################################################################

Google cloud platform intance Virtual Machine

			Server Debian 9 - 

Lo que esta encerrado en asteriscos *** es el codigo que se debe ejecutar en el servier.

##################################################################################################################################
##################################################################################################################################
##################################################################################################################################
##################################################################################################################################

________________________________________________________________________________________________________________________________________________________________

-> PRIMERO


loguearse como root y update de apt-get

****************************************************************************************************************************************************************
sudo su - 
sudo apt-get update
****************************************************************************************************************************************************************


________________________________________________________________________________________________________________________________________________________________

-> INSTALAR JAVA

Crear directorio para java, descargar archivos y descomprimir file

****************************************************************************************************************************************************************
mkdir /usr/lib/jvm
cd /usr/lib/jvm
sudo wget -c --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/8u131-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk-8u131-linux-x64.tar.gz
sudo tar -xvzf jdk-8u131-linux-x64.tar.gz
****************************************************************************************************************************************************************

instalaciones java

****************************************************************************************************************************************************************
sudo update-alternatives --install "/usr/bin/java" "java" "/usr/lib/jvm/jdk1.8.0_131/bin/java" 0
sudo update-alternatives --install "/usr/bin/javac" "javac" "/usr/lib/jvm/jdk1.8.0_131/bin/javac" 0
sudo update-alternatives --set java /usr/lib/jvm/jdk1.8.0_131/bin/java
sudo update-alternatives --set javac /usr/lib/jvm/jdk1.8.0_131/bin/javac
update-alternatives --list java
update-alternatives --list javac
****************************************************************************************************************************************************************

se borran archivos

****************************************************************************************************************************************************************
rm jdk-8u131-linux-x64.tar.gz
****************************************************************************************************************************************************************

se crean variables de contexto

****************************************************************************************************************************************************************

export J2SDKDIR=/usr/lib/jvm/jdk1.8.0_131
export J2REDIR=/usr/lib/jvm/jdk1.8.0_131/jre
export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_131
export DERBY_HOME=/usr/lib/jvm/jdk1.8.0_131/db
export PATH=$JAVA_HOME/bin:$PATH
****************************************************************************************************************************************************************

version instalada

****************************************************************************************************************************************************************
java -version
****************************************************************************************************************************************************************

________________________________________________________________________________________________________________________________________________________________

-> INSTALAR MAVEN


se descarga archivo ejecutable y se descomprime

****************************************************************************************************************************************************************
cd /opt
sudo wget -c --header "Cookie: oraclelicense=accept-securebackup-cookie" https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.5.0/apache-maven-3.5.0-bin.tar.gz
sudo tar -xvzf apache-maven-3.5.0-bin.tar.gz
****************************************************************************************************************************************************************

Se setean variables de contexto:

1 - abrimos archivo
****************************************************************************************************************************************************************
sudo vi /etc/environment
****************************************************************************************************************************************************************

2- copiar y pegar estas lineas
****************************************************************************************************************************************************************
M2_HOME="/opt/apache-maven-3.5.0"
M2="$M2_HOME/bin"
PATH="$M2:$PATH"
****************************************************************************************************************************************************************


instalaciones maven
****************************************************************************************************************************************************************
sudo update-alternatives --install "/usr/bin/mvn" "mvn" "/opt/apache-maven-3.5.0/bin/mvn" 0
sudo update-alternatives --set mvn /opt/apache-maven-3.5.0/bin/mvn
****************************************************************************************************************************************************************


Obtiene bash y elemina archivo
****************************************************************************************************************************************************************
sudo wget https://raw.github.com/dimaj/maven-bash-completion/master/bash_completion.bash --output-document /etc/bash_completion.d/mvn
rm apache-maven-3.5.0-bin.tar.gz
****************************************************************************************************************************************************************


________________________________________________________________________________________________________________________________________________________________

-> INSTALAR TOMCAT


se instala tomcat con servicio de apt
****************************************************************************************************************************************************************
sudo apt-get install apache2 -y
****************************************************************************************************************************************************************

se modifica index (este pasom no es necesario)
****************************************************************************************************************************************************************
echo '<!doctype html><html><body><h1>Hello World!</h1></body></html>' | sudo tee /var/www/html/index.html
****************************************************************************************************************************************************************

________________________________________________________________________________________________________________________________________________________________

-> INSTALAR JENKINS

posicionamos en directorio y descargamos archivo

****************************************************************************************************************************************************************
cd /opt
wget -q -O - https://pkg.jenkins.io/debian/jenkins-ci.org.key | sudo apt-key add -
sudo sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'
****************************************************************************************************************************************************************

se hace update
****************************************************************************************************************************************************************
sudo apt-get update
****************************************************************************************************************************************************************

se instala jenkins por apt-get

****************************************************************************************************************************************************************
sudo apt-get install jenkins
****************************************************************************************************************************************************************

se levantan servicios y se consulta status
****************************************************************************************************************************************************************
sudo service jenkins start
sudo service jenkins status
****************************************************************************************************************************************************************


________________________________________________________________________________________________________________________________________________________________

-> INSTALAR GITHUB

se instala github con apt-get

****************************************************************************************************************************************************************
sudo apt install git-all
****************************************************************************************************************************************************************

________________________________________________________________________________________________________________________________________________________________

-> CREA CARPETA DEPLY Y SCRIPTS

se crean directorios para ver los logs en tomcat de manera online sin tener que conectarse al Server
****************************************************************************************************************************************************************
sudo mkdir /var/www/html/logs
sudo mkdir /var/www/html/logs/loaders
****************************************************************************************************************************************************************

se crean directorios para deploy de java ejecutable y scripts
****************************************************************************************************************************************************************
sudo mkdir /mnt/loaders
sudo mkdir /mnt/loaders/loaders-app
sudo mkdir /mnt/loaders/scripts
****************************************************************************************************************************************************************

se agregan permisos para Jenkins a carpeta de scripts
****************************************************************************************************************************************************************
sudo chown -R jenkins /mnt/loaders/loaders-app/
sudo chown -R jenkins /mnt/loaders/scripts/
****************************************************************************************************************************************************************


________________________________________________________________________________________________________________________________________________________________

-> EJECUTAR JENKINS COMO ROOT

https://community.talend.com/t5/Migration-Configuration-and/How-do-I-change-the-Jenkins-service-account-user/ta-p/45164

modificar archivo jenkins para ejecutar como root los procesos

****************************************************************************************************************************************************************
sudo vi /etc/default/jenkins
****************************************************************************************************************************************************************

cambiar
****************************************************************************************************************************************************************
JENKINS_USER=root
JENKINS_GROUP=root
****************************************************************************************************************************************************************

se dan permisos
****************************************************************************************************************************************************************
chown -R root:root /var/lib/jenkins
chown -R root:root /var/cache/jenkins
chown -R root:root /var/log/jenkins
****************************************************************************************************************************************************************

se reinicia serivios de jenkins
****************************************************************************************************************************************************************
/etc/init.d/jenkins restart
****************************************************************************************************************************************************************


________________________________________________________________________________________________________________________________________________________________

-> INSTALAR GOOGLE CLOUD PLATFORM

(viene por defecto en GCP VM)

________________________________________________________________________________________________________________________________________________________________

-> INSTALAR PYTHON Y JUPYTER


https://linuxize.com/post/how-to-install-pip-on-debian-9/

________________________________________________________________________________________________________________________________________________________

-> INSTALAR SPARK Y JUPYTER EN VM

https://shuzhanfan.github.io/2018/01/running-Jupyter-Notebook-with-Apache-Spark-on-Google-Cloud/
